var e=Object.defineProperty,t=(t,n,s)=>((t,n,s)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s)(t,"symbol"!=typeof n?n+"":n,s);import{u as n,j as s}from"./vendor-De9eBGiU.js";function r(e){const{PongGame:t,UnderConstructionNotice:r}={...n(),...e.components};return t||i("PongGame"),r||i("UnderConstructionNotice"),s.jsxs(s.Fragment,{children:[s.jsx(r,{}),"\n",s.jsx(t,{})]})}function i(e,t){throw new Error("Expected component `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}const l=Object.freeze(Object.defineProperty({__proto__:null,date:"2025-02-21",default:function(e={}){const{wrapper:t}={...n(),...e.components};return t?s.jsx(t,{...e,children:s.jsx(r,{...e})}):r(e)},excerpt:"My journey porting and optimizing Friday Night Funkin' for iOS devices",title:"The First FNF iOS Port"},Symbol.toStringTag,{value:"Module"}));function o(e){const t={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...n(),...e.components},{ImageCarousel:r}=t;return r||function(e){throw new Error("Expected component `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("ImageCarousel"),s.jsxs(s.Fragment,{children:[s.jsx(r,{images:[{src:"/assets/img/blog-post-imgs/hybrid-graphics-kvm-arch/fastfetch-sysinfo.png",alt:"System information output showing specifications of my (muxless) RedmiBook Pro",caption:"System specifications from fastfetch"},{src:"/assets/img/blog-post-imgs/hybrid-graphics-kvm-arch/hybrid-kvm-redmibook.png",alt:"Windows 10 virtual machine running with NVIDIA graphics acceleration on the muxless Redmibook!",caption:"Windows 10 virtual machine running with NVIDIA graphics acceleration on the muxless Redmibook!"}]}),"\n",s.jsx(t.h3,{children:"Laptop Specifications"}),"\n",s.jsxs(t.ul,{children:["\n",s.jsx(t.li,{children:"Model: RedmiBook Pro 15 (2021)"}),"\n",s.jsx(t.li,{children:"CPU: Intel i7-11370H (4 cores, 8 threads)"}),"\n",s.jsx(t.li,{children:"dGPU: NVIDIA MX450, 2GB VRAM"}),"\n",s.jsx(t.li,{children:"iGPU: Iris Xe Graphics (TGL2)"}),"\n",s.jsx(t.li,{children:"RAM: 16GB 3200MHz Soldered RAM :("}),"\n",s.jsx(t.li,{children:'Display: 15.6" 3200x2000 90Hz IPS (!!!)'}),"\n"]}),"\n",s.jsx(t.h3,{children:"Preamble"}),"\n",s.jsxs(t.p,{children:["Linux is great, but ",s.jsx(t.code,{children:"${CURRENT_YEAR}"})," is still not quite the year of Linux on the desktop (or laptop, for that matter). Lots of software and games will simply never get ported to Linux, and sometimes frameworks that aim to run Windows programs on Linux like Wine and Proton aren't good enough for some software yet..."]}),"\n",s.jsx(t.p,{children:"Thus, KVMs (kernel-based virtual machines) for Windows with GPU passthrough are desirable and oftentimes a necessity for many Linux users."}),"\n",s.jsx(t.p,{children:"One of the biggest difficulties when setting up a Windows KVM on a hybrid graphics machines is actually being able to SEE the graphically-accelerated output from the passed-through dGPU through the host."}),"\n",s.jsx(t.h3,{children:"Requirements/Software Used"}),"\n",s.jsxs(t.ul,{children:["\n",s.jsx(t.li,{children:"A laptop with at least two GPUs (iGPU and dGPU)"}),"\n",s.jsxs(t.li,{children:["Linux software:","\n",s.jsxs(t.ul,{children:["\n",s.jsx(t.li,{children:"I used Arch (btw) but the same general setup should work across distros?"}),"\n",s.jsx(t.li,{children:"libvirtd, virt-manager, qemu, etc."}),"\n",s.jsx(t.li,{children:s.jsx(t.a,{href:"https://aur.archlinux.org/packages/looking-glass-module-dkms",children:"looking-glass-module-dkms"})}),"\n"]}),"\n"]}),"\n",s.jsxs(t.li,{children:["Windows VM software:","\n",s.jsxs(t.ul,{children:["\n",s.jsx(t.li,{children:"looking-glass-host"}),"\n",s.jsx(t.li,{children:"Virtual-Display-Driver"}),"\n"]}),"\n"]}),"\n"]}),"\n",s.jsx(t.h3,{children:"Getting our (Arch) Linux host ready"}),"\n",s.jsxs(t.blockquote,{children:["\n",s.jsxs(t.p,{children:[s.jsx(t.strong,{children:"NOTE:"})," These steps are largely based off the instructions outlined in the ",s.jsx(t.a,{href:"https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Binding_vfio-pci_via_device_ID",children:"PCI passthrough via OVMF"})," page on the Arch Linux Wiki, as well as ",s.jsx(t.a,{href:"https://gist.github.com/tatumroaquin/c6464e1ccaef40fd098a4f31db61ab22",children:"this great QEMU-KVM setup guide for Arch Linux"})," by ",s.jsx(t.a,{href:"https://gist.github.com/tatumroaquin",children:"tatumroaquin"}),"!"]}),"\n"]}),"\n",s.jsxs(t.ol,{children:["\n",s.jsx(t.li,{children:s.jsx(t.a,{href:"https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Setting_up_IOMMU",children:"Verify that IOMMU is enabled"})}),"\n",s.jsx(t.li,{children:s.jsx(t.a,{href:"https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Ensuring_that_the_groups_are_valid",children:"Ensure your IOMMU groups are valid"})}),"\n",s.jsxs(t.li,{children:[s.jsx(t.a,{href:"https://gist.github.com/tatumroaquin/c6464e1ccaef40fd098a4f31db61ab22#install-qemu-libvirt-viewers-and-tools",children:"Install the necessary packages"})," (",s.jsx(t.code,{children:"sudo pacman -S qemu-desktop libvirt dnsmasq swtpm edk2-ovmf"}),")"]}),"\n",s.jsxs(t.li,{children:["Add your user to the libvirt group (",s.jsx(t.code,{children:"sudo usermod -a -G libvirt $USER"}),")"]}),"\n",s.jsxs(t.li,{children:["Uncomment and modify lines in ",s.jsx(t.code,{children:"/etc/libvirt/qemu.conf"}),":"]}),"\n"]}),"\n",s.jsxs("details",{children:[s.jsxs("summary",{children:["Example ",s.jsx("code",{children:"/etc/libvirt/qemu.conf"})," changes"]}),s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," nano /etc/libvirt/qemu.conf\n"]})}),s.jsx(t.pre,{children:s.jsx(t.code,{className:"hljs language-conf",children:'# MODIFY THE LINE BELOW TO INCLUDE YOUR $USER\nuser = "nick" # MODIFY THIS LINE TO INCLUDE YOUR $USER\n\n# UNCOMMENT THE BLOCK BELOW, ADD "/dev/kvmfr0" TO THE ARRAY LIKE SO!\ncgroup_device_acl = [\n    "/dev/null", "/dev/full", "/dev/zero",\n    "/dev/random", "/dev/urandom",\n    "/dev/ptmx", "/dev/kvm",\n    "/dev/userfaultfd", "/dev/kvmfr0"\n]\n# UNCOMMENT THE BLOCK ABOVE, ADD "/dev/kvmfr0" TO THE ARRAY LIKE SO!\n'})})]}),"\n",s.jsxs(t.ol,{start:"6",children:["\n",s.jsxs(t.li,{children:["Enable & start libvirtd.service:",s.jsx(t.br,{}),"\n",s.jsx(t.code,{children:"sudo systemctl enable --now libvirtd.service"})]}),"\n",s.jsxs(t.li,{children:["Start the libvirt network:",s.jsx(t.br,{}),"\n",s.jsx(t.code,{children:"sudo virsh net-autostart default"})]}),"\n",s.jsxs(t.li,{children:["Create ",s.jsx(t.code,{children:"/etc/modules-load.d/kvmfr.conf"})," to load the ",s.jsx(t.code,{children:"kvmfr"})," module for Looking-Glass on boot:",s.jsx(t.br,{}),"\n",s.jsx(t.code,{children:"sudo nano /etc/modules-load.d/kvmfr.conf"}),s.jsx(t.br,{}),"\n","Contents:","\n",s.jsx(t.pre,{children:s.jsx(t.code,{children:"# KVMFR Looking Glass module\nkvmfr\n"})}),"\n"]}),"\n",s.jsxs(t.li,{children:["Create ",s.jsx(t.code,{children:"/etc/modprobe.d/kvmfr.conf"})," to set the framebuffer size on boot (Calculate framebuffer size ",s.jsx(t.a,{href:"https://looking-glass.io/docs/B7/install_libvirt/#determining-memory",children:"here"}),"):",s.jsx(t.br,{}),"\n",s.jsx(t.code,{children:"sudo nano /etc/modprobe.d/kvmfr.conf"}),s.jsx(t.br,{}),"\n","Contents:","\n",s.jsx(t.pre,{children:s.jsx(t.code,{children:"options kvmfr static_size_mb=64\n"})}),"\n"]}),"\n",s.jsxs(t.li,{children:["Create ",s.jsx(t.code,{children:"99-kvmfr.rules"})," udev rule to correct kvmfr0 permissions:",s.jsx(t.br,{}),"\n",s.jsx(t.code,{children:"sudo nano /etc/udev/rules.d/99-kvmfr.rules"}),s.jsx(t.br,{}),"\n","Contents:","\n",s.jsx(t.pre,{children:s.jsx(t.code,{children:'# REPLACE $USER WITH YOUR USERNAME!!\nSUBSYSTEM=="kvmfr", OWNER="$USER", GROUP="kvm", MODE="0660"\n'})}),"\n"]}),"\n",s.jsxs(t.li,{children:["Run the following or just rebuild initramfs & reboot:",s.jsx(t.br,{}),"\n",s.jsx(t.code,{children:"sudo modprobe kvmfr static_size_mb=64"})]}),"\n",s.jsxs(t.li,{children:["Create Windows VM using ",s.jsx(t.code,{children:"virt-manager"}),", but don't attach the dGPU yet!"]}),"\n"]}),"\n",s.jsx(t.h3,{children:"Setting up dynamically unbinding the NVIDIA GPU from the Linux host"}),"\n",s.jsxs(t.p,{children:[s.jsx(t.a,{href:"https://passthroughpo.st/simple-per-vm-libvirt-hooks-with-the-vfio-tools-hook-helper/",children:"Set up QEMU hooks"})," by simply creating the ",s.jsx(t.code,{children:"hooks"})," directory and running the script provided by PassthroughPOST:"]}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," ",s.jsx(t.span,{className:"hljs-built_in",children:"mkdir"})," -p /etc/libvirt/hooks\n",s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," wget ",s.jsx(t.span,{className:"hljs-string",children:"'https://raw.githubusercontent.com/PassthroughPOST/VFIO-Tools/master/libvirt_hooks/qemu'"})," -O /etc/libvirt/hooks/qemu\n",s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," ",s.jsx(t.span,{className:"hljs-built_in",children:"chmod"})," +x /etc/libvirt/hooks/qemu\n"]})}),"\n",s.jsxs(t.p,{children:["Then, create a folder at ",s.jsx(t.code,{children:"/etc/libvirt/hooks/qemu.d/"})," with the name of the VM you created earlier."]}),"\n",s.jsxs(t.p,{children:["For example, let's say you named your VM ",s.jsx(t.code,{children:"Windows-11"}),":"]}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-bash",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," ",s.jsx(t.span,{className:"hljs-built_in",children:"mkdir"})," -p /etc/libvirt/hooks/qemu.d/Windows-11/\n"]})}),"\n",s.jsx(t.p,{children:"Create the folders for the begin and end hooks:"}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-bash",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," ",s.jsx(t.span,{className:"hljs-built_in",children:"mkdir"})," -p /etc/libvirt/hooks/qemu.d/",s.jsx(t.span,{className:"hljs-variable",children:"${VMNAME}"}),"/prepare/begin\n",s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," ",s.jsx(t.span,{className:"hljs-built_in",children:"mkdir"})," -p /etc/libvirt/hooks/qemu.d/",s.jsx(t.span,{className:"hljs-variable",children:"${VMNAME}"}),"/release/end\n"]})}),"\n",s.jsx(t.p,{children:"Finally, we can create our start and stop scripts:"}),"\n",s.jsx(t.p,{children:s.jsx(t.strong,{children:"prepare/begin/start.sh"})}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-meta",children:"#!/bin/bash"}),"\n",s.jsx(t.span,{className:"hljs-comment",children:"# Unload NVIDIA Modules"}),"\nmodprobe -r nvidia_uvm nvidia_drm nvidia_modeset nvidia\n",s.jsx(t.span,{className:"hljs-comment",children:"# stop nvidia-persistenced"}),"\nsystemctl stop nvidia-persistenced.service\n"]})}),"\n",s.jsx(t.p,{children:s.jsx(t.strong,{children:"release/end/stop.sh"})}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-meta",children:"#!/bin/bash"}),"\n",s.jsx(t.span,{className:"hljs-comment",children:"# Re-load NVIDIA Modules"}),"\nmodprobe nvidia\n",s.jsx(t.span,{className:"hljs-built_in",children:"sleep"})," 1\nmodprobe nvidia_modeset\n",s.jsx(t.span,{className:"hljs-built_in",children:"sleep"})," 1\nmodprobe nvidia_uvm\n",s.jsx(t.span,{className:"hljs-built_in",children:"sleep"})," 1\nmodprobe nvidia_drm\n",s.jsx(t.span,{className:"hljs-built_in",children:"sleep"})," 1\n",s.jsx(t.span,{className:"hljs-comment",children:"# (re)start nvidia-persistenced"}),"\nsystemctl start nvidia-persistenced\n"]})}),"\n",s.jsx(t.p,{children:"Make these scripts executable:"}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-built_in",children:"chmod"})," +x /etc/libvirt/hooks/qemu.d/",s.jsx(t.span,{className:"hljs-variable",children:"${VMNAME}"}),"/prepare/begin/start.sh\n",s.jsx(t.span,{className:"hljs-built_in",children:"chmod"})," +x /etc/libvirt/hooks/qemu.d/",s.jsx(t.span,{className:"hljs-variable",children:"${VMNAME}"}),"/release/end/stop.sh\n"]})}),"\n",s.jsx(t.p,{children:"Restart libvirtd:"}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," systemctl restart libvirtd\n"]})}),"\n",s.jsxs(t.p,{children:["Add the NVIDIA dGPU PCI device(s) to your VM using ",s.jsx(t.code,{children:"virt-manager"}),"!"]}),"\n",s.jsxs(t.p,{children:["Starting the VM with these scripts should successfully 'unload' the NVIDIA GPU from Linux and 'give it' to the Windows VM!\nNo need to touch ",s.jsx(t.code,{children:"vfio_pci"})," drivers... :)"]}),"\n",s.jsx(t.h2,{children:"Getting accelerated video output through Looking-Glass without a physical dummy plug using Virtual Display Driver (VDD)"}),"\n",s.jsxs(t.p,{children:["Once your Windows VM can boot with the NVIDIA card attached, use the SPICE/VGA video passthrough through ",s.jsx(t.code,{children:"virt-manager"})," to complete the Windows setup and install the NVIDIA graphics drivers."]}),"\n",s.jsxs(t.p,{children:["Once the NVIDIA drivers are installed, download and install the latest releases of ",s.jsx(t.a,{href:"https://looking-glass.io/downloads",children:"Looking-Glass-Host"})," and ",s.jsx(t.a,{href:"https://github.com/VirtualDisplay/Virtual-Display-Driver/releases/latest",children:"Virtual-Display-Driver"}),"."]}),"\n",s.jsxs(t.p,{children:["Here's the weird part. In my experience, simply removing the SPICE video devices from the VM via ",s.jsx(t.code,{children:"virt-manager"})," would result in Looking-Glass giving a blank/black picture, regardless of which display was set default in Windows, etc."]}),"\n",s.jsx(t.p,{children:"I worked around this by doing the following, in this order:"}),"\n",s.jsxs(t.ul,{children:["\n",s.jsx(t.li,{children:"Right clicked the desktop to get to Display Settings (or go to Windows Settings > System > Display Settings)"}),"\n",s.jsx(t.li,{children:"Determined which output/screen index corresponded to either SPICE or the Virtual Display by going to 'Advanced Display' ('Wired Monitor' is usually SPICE, Virtual Display Driver should be obvious by its name)"}),"\n",s.jsx(t.li,{children:"For this example, we will assume that SPICE = Display 1, VDD = Display 2."}),"\n",s.jsx(t.li,{children:"Select the option to show only on the Virtual Display Device. So, if VDD is Display 2, select 'Show only on 2'."}),"\n",s.jsxs(t.li,{children:["Both screens (Looking-Glass AND SPICE via ",s.jsx(t.code,{children:"virt-manager"}),") SHOULD BE BLACK."]}),"\n",s.jsxs(t.li,{children:["QUICKLY* turn off the VM via ",s.jsx(t.code,{children:"virt-manager"})," (through the host), and turn it back on once it's powered off fully. (*do it within ~15 seconds to prevent Windows from undoing the changes)"]}),"\n",s.jsx(t.li,{children:"Upon the next boot, Looking-Glass should be the only 'display' active. This display should have functioning graphics acceleration via the NVIDIA card unlike the regular old SPICE window, all without a physical dummy connector!"}),"\n"]}),"\n",s.jsx(t.p,{children:"There's probably a more elegant way of disabling the SPICE monitor to enable proper output via Looking-Glasss, but this worked for me."}),"\n",s.jsx(t.h3,{children:"WHY are we doing this?"}),"\n",s.jsx(t.p,{children:"The most common solution in the past was to use a HDMI/DisplayPort dummy display plug plugged into one of the laptop's dGPU outputs, 'simulating' a display for the passed-through dGPU to render to, alongside Looking-Glass to then mirror that accelerated 'display' from the guest to the host's internal display on Linux through the Looking-Glass client. Another solution was to simply just not use the internal display for KVMs when doing accelerated passthrough at all and to use an external display plugged into the laptop for KVMs."}),"\n",s.jsx(t.p,{children:"These solutions work, but... they either require the purchase & constant use of a physical dummy plug, or the reliance on an external monitor when using our Windows KVM. There's nothing wrong with this, but these solutions aren't quite 'elegant' and do not work for muxless laptops."}),"\n",s.jsx(t.h3,{children:"Muxless? Muxed?"}),"\n",s.jsxs(t.p,{children:["The laptop I use to demonstrate this is ",s.jsx(t.em,{children:"muxless"}),", meaning that ALL graphics/video/display shown on the internal and external displays are 'presented' using the iGPU. That means that even if the NVIDIA dGPU is rendering something, the NVIDIA dGPU 'relies' on the Intel iGPU to actually 'show' what it's doing."]}),"\n",s.jsxs(t.p,{children:["A ",s.jsx(t.em,{children:"muxed"})," laptop, on the other hand, supports dynamic switching between the iGPU/dGPU for the internal and external displays. Muxed laptops are often regarded as being 'better' for KVMs and GPU passthrough vs. muxless laptops, however, in my experience, both setups have very similar difficulties that are solved largely in the same ways, and neither is 'objectively better' for the purposes of running a graphically-accelerated KVM (in my experience)."]}),"\n",s.jsx(t.p,{children:"PRACTICALLY SPEAKING... the 'method'/strategy we will be using in this guide to get graphically accelerated output from our Windows KVM should work whether you have a muxed or muxless laptop!"}),"\n",s.jsxs(t.h3,{children:["Solving ",s.jsx(t.code,{children:"modprobe: FATAL: Module nvidia_drm is in use"})]}),"\n",s.jsx(t.h4,{children:"PROBLEM:"}),"\n",s.jsxs(t.p,{children:["Some applications use ",s.jsx(t.code,{children:"nvidia_drm"})," unexpectedly, therefore not allowing the ",s.jsx(t.code,{children:"start.sh"})," QEMU hook to run correctly. This problem could be a symptom of another issue with my configuration and could possibly be solved a 'better' way, but this solution works well enough for me:"]}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," modprobe -r nvidia_drm\n",s.jsx(t.span,{className:"hljs-comment",children:"# modprobe: FATAL: Module nvidia_drm is in use."}),"\n"]})}),"\n",s.jsxs(t.p,{children:["Running ",s.jsx(t.code,{children:"sudo lsmod | grep nvidia"})," revealed that 2 processes that were using ",s.jsx(t.code,{children:"nvidia_drm"}),":"]}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:[s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," lsmod | grep -iE nvidia\nnvidia_drm            139264  2\nnvidia_modeset       1830912  1 nvidia_drm\nnvidia              96956416  6 nvidia_modeset\ndrm_ttm_helper         16384  2 nvidia_drm,xe\nvideo                  81920  3 xe,i915,nvidia_modeset\n"]})}),"\n",s.jsxs(t.p,{children:["Running ",s.jsx(t.code,{children:"sudo lsof | grep -iE nvidia"})," gave me the list/history of processes that have run on the NVIDIA driver. I saw a whole bunch of entries for ",s.jsx(t.code,{children:"electron"}),". I closed all Electron apps running (Discord, Mullvad VPN, Beeper etc.) and re-ran ",s.jsx(t.code,{children:"sudo lsmod | grep nvidia"}),":"]}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:["nick@hybrid:~$ ",s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," lsmod | grep -iE nvidia\nnvidia_uvm           3977216  0\nnvidia_drm            139264  0\nnvidia_modeset       1830912  1 nvidia_drm\nnvidia              96956416  2 nvidia_uvm,nvidia_modeset\ndrm_ttm_helper         16384  2 nvidia_drm,xe\nvideo                  81920  3 xe,i915,nvidia_modeset\n"]})}),"\n",s.jsxs(t.p,{children:["Now ",s.jsx(t.code,{children:"nvidia_drm"})," is being used by 0 processes, so we can now unload ",s.jsx(t.code,{children:"nvidia"})," drivers successfully:"]}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:["nick@hybrid:~$ ",s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," modprobe -r nvidia_uvm nvidia_drm nvidia_modeset nvidia \n\nnick@hybrid:~$ \n"]})}),"\n",s.jsxs(t.p,{children:["My solution is kinda lazy, but works well enough for me. For each application that was using ",s.jsx(t.code,{children:"nvidia_drm"}),", I added ",s.jsx(t.code,{children:"VK_ICD_FILENAMES=/usr/share/vulkan/icd.d/intel_icd.x86_64.json"})," to the ",s.jsx(t.code,{children:"Environment variables"})," of Discord*, Mullvad VPN and Beeper. For more 'stubbourn' programs, I simply add a ",s.jsx(t.code,{children:"pkill"})," line for that program to the ",s.jsx(t.code,{children:"start.sh"})," script of my VM, and you can even automatically restart the ",s.jsx(t.code,{children:"pkill"}),"'d application using another QEMU hook!"]}),"\n",s.jsxs(t.p,{children:["Contents of ",s.jsx(t.code,{children:"/etc.modprobe.d/nvidia.conf"}),":"]}),"\n",s.jsx(t.pre,{children:s.jsx(t.code,{className:"hljs language-conf",children:'options nvidia "NVreg_EnableGpuFirmware=0"\n'})}),"\n",s.jsx(t.p,{children:"These options disable (part of?) the NVIDIA GPU firmware? Without this option, the card would stay in D0 and never enter D3cold."}),"\n",s.jsx(t.pre,{children:s.jsxs(t.code,{className:"hljs language-sh",children:["nick@hybrid:~$ ",s.jsx(t.span,{className:"hljs-built_in",children:"sudo"})," ",s.jsx(t.span,{className:"hljs-built_in",children:"cat"})," /proc/driver/nvidia/gpus/0000:2b:00.0/power\nRuntime D3 status:          Enabled (fine-grained)\nVideo Memory:               Off\n\nGPU Hardware Support:\n Video Memory Self Refresh: Supported\n Video Memory Off:          Supported\n\nS0ix Power Management:\n Platform Support:          Supported\n Status:                    Disabled\n\nNotebook Dynamic Boost:     Not Supported\n"]})})]})}const a=Object.freeze(Object.defineProperty({__proto__:null,date:"2025-02-27",default:function(e={}){const{wrapper:t}={...n(),...e.components};return t?s.jsx(t,{...e,children:s.jsx(o,{...e})}):o(e)},excerpt:"Tips on achieving graphics-accelerated VMs on a muxless (or muxed!) NVIDIA PRIME hybrid graphics laptop (or desktop), all without using a silly dummy plug :)",thumbnail:"/assets/img/hybrid-kvm-redmibook.png",title:"Dynamic GPU Passthrough on Muxless (or Muxed) Linux Hosts"},Symbol.toStringTag,{value:"Module"}));function c(e){const{PongGame:t,UnderConstructionNotice:r}={...n(),...e.components};return t||h("PongGame"),r||h("UnderConstructionNotice"),s.jsxs(s.Fragment,{children:[s.jsx(r,{}),"\n",s.jsx(t,{})]})}function h(e,t){throw new Error("Expected component `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}const p=Object.freeze(Object.defineProperty({__proto__:null,date:"2025-02-22",default:function(e={}){const{wrapper:t}={...n(),...e.components};return t?s.jsx(t,{...e,children:s.jsx(c,{...e})}):c(e)},excerpt:"How far can we push Sony's best console?",title:"How I Built a 'PS3 Pro'"},Symbol.toStringTag,{value:"Module"}));function d(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let u={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function g(e){u=e}const x={exec:()=>null};function m(e,t=""){let n="string"==typeof e?e:e.source;const s={replace:(e,t)=>{let r="string"==typeof t?t:t.source;return r=r.replace(f.caret,"$1"),n=n.replace(e,r),s},getRegex:()=>new RegExp(n,t)};return s}const f={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},k=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,b=/(?:[*+-]|\d{1,9}[.)])/,w=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,j=m(w).replace(/bull/g,b).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),y=m(w).replace(/bull/g,b).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),v=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,S=/(?!\s*\])(?:\\.|[^\[\]\\])+/,_=m(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",S).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),$=m(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,b).getRegex(),R="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",I=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,T=m("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",I).replace("tag",R).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),A=m(v).replace("hr",k).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",R).getRegex(),E={blockquote:m(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",A).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:_,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:k,html:T,lheading:j,list:$,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:A,table:x,text:/^[^\n]+/},P=m("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",k).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",R).getRegex(),N={...E,lheading:y,table:P,paragraph:m(v).replace("hr",k).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",P).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",R).getRegex()},M={...E,html:m("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",I).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:x,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:m(v).replace("hr",k).replace("heading"," *#{1,6} *[^\n]").replace("lheading",j).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},D=/^( {2,}|\\)\n(?!\s*$)/,z=/[\p{P}\p{S}]/u,L=/[\s\p{P}\p{S}]/u,C=/[^\s\p{P}\p{S}]/u,V=m(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,L).getRegex(),O=/(?!~)[\p{P}\p{S}]/u,U=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,q=m(U,"u").replace(/punct/g,z).getRegex(),G=m(U,"u").replace(/punct/g,O).getRegex(),B="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",F=m(B,"gu").replace(/notPunctSpace/g,C).replace(/punctSpace/g,L).replace(/punct/g,z).getRegex(),H=m(B,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,O).getRegex(),W=m("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,C).replace(/punctSpace/g,L).replace(/punct/g,z).getRegex(),Z=m(/\\(punct)/,"gu").replace(/punct/g,z).getRegex(),K=m(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Q=m(I).replace("(?:--\x3e|$)","--\x3e").getRegex(),Y=m("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Q).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),X=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,J=m(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",X).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),ee=m(/^!?\[(label)\]\[(ref)\]/).replace("label",X).replace("ref",S).getRegex(),te=m(/^!?\[(ref)\](?:\[\])?/).replace("ref",S).getRegex(),ne={_backpedal:x,anyPunctuation:Z,autolink:K,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:D,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:x,emStrongLDelim:q,emStrongRDelimAst:F,emStrongRDelimUnd:W,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:J,nolink:te,punctuation:V,reflink:ee,reflinkSearch:m("reflink|nolink(?!\\()","g").replace("reflink",ee).replace("nolink",te).getRegex(),tag:Y,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:x},se={...ne,link:m(/^!?\[(label)\]\((.*?)\)/).replace("label",X).getRegex(),reflink:m(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",X).getRegex()},re={...ne,emStrongRDelimAst:H,emStrongLDelim:G,url:m(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},ie={...re,br:m(D).replace("{2,}","*").getRegex(),text:m(re.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},le={normal:E,gfm:N,pedantic:M},oe={normal:ne,gfm:re,breaks:ie,pedantic:se},ae={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ce=e=>ae[e];function he(e,t){if(t){if(f.escapeTest.test(e))return e.replace(f.escapeReplace,ce)}else if(f.escapeTestNoEncode.test(e))return e.replace(f.escapeReplaceNoEncode,ce);return e}function pe(e){try{e=encodeURI(e).replace(f.percentDecode,"%")}catch{return null}return e}function de(e,t){const n=e.replace(f.findPipe,((e,t,n)=>{let s=!1,r=t;for(;--r>=0&&"\\"===n[r];)s=!s;return s?"|":" |"})).split(f.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(f.slashPipe,"|");return n}function ue(e,t,n){const s=e.length;if(0===s)return"";let r=0;for(;r<s;){if(e.charAt(s-r-1)!==t)break;r++}return e.slice(0,s-r)}function ge(e,t,n,s,r){const i=t.href,l=t.title||null,o=e[1].replace(r.other.outputLinkReplace,"$1");if("!"!==e[0].charAt(0)){s.state.inLink=!0;const e={type:"link",raw:n,href:i,title:l,text:o,tokens:s.inlineTokens(o)};return s.state.inLink=!1,e}return{type:"image",raw:n,href:i,title:l,text:o}}class xe{constructor(e){t(this,"options"),t(this,"rules"),t(this,"lexer"),this.options=e||u}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:ue(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=function(e,t,n){const s=e.match(n.other.indentCodeCompensation);if(null===s)return t;const r=s[1];return t.split("\n").map((e=>{const t=e.match(n.other.beginningSpace);if(null===t)return e;const[s]=t;return s.length>=r.length?e.slice(r.length):e})).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){const t=ue(e,"#");this.options.pedantic?e=t.trim():t&&!this.rules.other.endingSpaceChar.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:ue(t[0],"\n")}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let e=ue(t[0],"\n").split("\n"),n="",s="";const r=[];for(;e.length>0;){let t=!1;const i=[];let l;for(l=0;l<e.length;l++)if(this.rules.other.blockquoteStart.test(e[l]))i.push(e[l]),t=!0;else{if(t)break;i.push(e[l])}e=e.slice(l);const o=i.join("\n"),a=o.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}\n${o}`:o,s=s?`${s}\n${a}`:a;const c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(a,r,!0),this.lexer.state.top=c,0===e.length)break;const h=r.at(-1);if("code"===h?.type)break;if("blockquote"===h?.type){const t=h,i=t.raw+"\n"+e.join("\n"),l=this.blockquote(i);r[r.length-1]=l,n=n.substring(0,n.length-t.raw.length)+l.raw,s=s.substring(0,s.length-t.text.length)+l.text;break}if("list"!==h?.type);else{const t=h,i=t.raw+"\n"+e.join("\n"),l=this.list(i);r[r.length-1]=l,n=n.substring(0,n.length-h.raw.length)+l.raw,s=s.substring(0,s.length-t.raw.length)+l.raw,e=i.substring(r.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:n,tokens:r,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,r={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const i=this.rules.other.listItemRegex(n);let l=!1;for(;e;){let n=!1,s="",o="";if(!(t=i.exec(e)))break;if(this.rules.block.hr.test(e))break;s=t[0],e=e.substring(s.length);let a=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],h=!a.trim(),p=0;if(this.options.pedantic?(p=2,o=a.trimStart()):h?p=t[1].length+1:(p=t[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,o=a.slice(p),p+=t[1].length),h&&this.rules.other.blankLine.test(c)&&(s+=c+"\n",e=e.substring(c.length+1),n=!0),!n){const t=this.rules.other.nextBulletRegex(p),n=this.rules.other.hrRegex(p),r=this.rules.other.fencesBeginRegex(p),i=this.rules.other.headingBeginRegex(p),l=this.rules.other.htmlBeginRegex(p);for(;e;){const d=e.split("\n",1)[0];let u;if(c=d,this.options.pedantic?(c=c.replace(this.rules.other.listReplaceNesting,"  "),u=c):u=c.replace(this.rules.other.tabCharGlobal,"    "),r.test(c))break;if(i.test(c))break;if(l.test(c))break;if(t.test(c))break;if(n.test(c))break;if(u.search(this.rules.other.nonSpaceChar)>=p||!c.trim())o+="\n"+u.slice(p);else{if(h)break;if(a.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(r.test(a))break;if(i.test(a))break;if(n.test(a))break;o+="\n"+c}h||c.trim()||(h=!0),s+=d+"\n",e=e.substring(d.length+1),a=u.slice(p)}}r.loose||(l?r.loose=!0:this.rules.other.doubleBlankLine.test(s)&&(l=!0));let d,u=null;this.options.gfm&&(u=this.rules.other.listIsTask.exec(o),u&&(d="[ ] "!==u[0],o=o.replace(this.rules.other.listReplaceTask,""))),r.items.push({type:"list_item",raw:s,task:!!u,checked:d,loose:!1,text:o,tokens:[]}),r.raw+=s}const o=r.items.at(-1);if(!o)return;o.raw=o.raw.trimEnd(),o.text=o.text.trimEnd(),r.raw=r.raw.trimEnd();for(let e=0;e<r.items.length;e++)if(this.lexer.state.top=!1,r.items[e].tokens=this.lexer.blockTokens(r.items[e].text,[]),!r.loose){const t=r.items[e].tokens.filter((e=>"space"===e.type)),n=t.length>0&&t.some((e=>this.rules.other.anyLine.test(e.raw)));r.loose=n}if(r.loose)for(let e=0;e<r.items.length;e++)r.items[e].loose=!0;return r}}html(e){const t=this.rules.block.html.exec(e);if(t){return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(!t)return;if(!this.rules.other.tableDelimiter.test(t[2]))return;const n=de(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const e of s)this.rules.other.tableAlignRight.test(e)?i.align.push("right"):this.rules.other.tableAlignCenter.test(e)?i.align.push("center"):this.rules.other.tableAlignLeft.test(e)?i.align.push("left"):i.align.push(null);for(let e=0;e<n.length;e++)i.header.push({text:n[e],tokens:this.lexer.inline(n[e]),header:!0,align:i.align[e]});for(const e of r)i.rows.push(de(e,i.header.length).map(((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:i.align[t]}))));return i}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;const t=ue(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let s=0;s<e.length;s++)if("\\"===e[s])s++;else if(e[s]===t[0])n++;else if(e[s]===t[1]&&(n--,n<0))return s;return-1}(t[2],"()");if(e>-1){const n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],s="";if(this.options.pedantic){const e=this.rules.other.pedanticHrefTitle.exec(n);e&&(n=e[1],s=e[3])}else s=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(n=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?n.slice(1):n.slice(1,-1)),ge(t,{href:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n,title:s?s.replace(this.rules.inline.anyPunctuation,"$1"):s},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const e=t[(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){const e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return ge(n,e,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s)return;if(s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const n=[...s[0]].length-1;let r,i,l=n,o=0;const a="*"===s[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(a.lastIndex=0,t=t.slice(-1*e.length+n);null!=(s=a.exec(t));){if(r=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!r)continue;if(i=[...r].length,s[3]||s[4]){l+=i;continue}if((s[5]||s[6])&&n%3&&!((n+i)%3)){o+=i;continue}if(l-=i,l>0)continue;i=Math.min(i,i+l+o);const t=[...s[0]][0].length,a=e.slice(0,n+s.index+t+i);if(Math.min(n,i)%2){const e=a.slice(1,-1);return{type:"em",raw:a,text:e,tokens:this.lexer.inlineTokens(e)}}const c=a.slice(2,-2);return{type:"strong",raw:a,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(e),s=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return n&&s&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=t[1],n="mailto:"+e):(e=t[1],n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=t[0],n="mailto:"+e;else{let s;do{s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(s!==t[0]);e=t[0],n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}}class me{constructor(e){t(this,"tokens"),t(this,"options"),t(this,"state"),t(this,"tokenizer"),t(this,"inlineQueue"),this.tokens=[],this.tokens.links=Object.create(null),this.options=e||u,this.options.tokenizer=this.options.tokenizer||new xe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={other:f,block:le.normal,inline:oe.normal};this.options.pedantic?(n.block=le.pedantic,n.inline=oe.pedantic):this.options.gfm&&(n.block=le.gfm,this.options.breaks?n.inline=oe.breaks:n.inline=oe.gfm),this.tokenizer.rules=n}static get rules(){return{block:le,inline:oe}}static lex(e,t){return new me(t).lex(e)}static lexInline(e,t){return new me(t).inlineTokens(e)}lex(e){e=e.replace(f.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const e=this.inlineQueue[t];this.inlineTokens(e.src,e.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(f.tabCharGlobal,"    ").replace(f.spaceLine,""));e;){let s;if(this.options.extensions?.block?.some((n=>!!(s=n.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))continue;if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length);const n=t.at(-1);1===s.raw.length&&void 0!==n?n.raw+="\n":t.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length);const n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+s.raw,n.text+="\n"+s.text,this.inlineQueue.at(-1).src=n.text):t.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length);const n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+s.raw,n.text+="\n"+s.raw,this.inlineQueue.at(-1).src=n.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),t.push(s);continue}let r=e;if(this.options.extensions?.startBlock){let t=1/0;const n=e.slice(1);let s;this.options.extensions.startBlock.forEach((e=>{s=e.call({lexer:this},n),"number"==typeof s&&s>=0&&(t=Math.min(t,s))})),t<1/0&&t>=0&&(r=e.substring(0,t+1))}if(this.state.top&&(s=this.tokenizer.paragraph(r))){const i=t.at(-1);n&&"paragraph"===i?.type?(i.raw+="\n"+s.raw,i.text+="\n"+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):t.push(s),n=r.length!==e.length,e=e.substring(s.raw.length)}else if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length);const n=t.at(-1);"text"===n?.type?(n.raw+="\n"+s.raw,n.text+="\n"+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):t.push(s)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent)break;throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n=e,s=null;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(s=this.tokenizer.rules.inline.reflinkSearch.exec(n));)e.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(s=this.tokenizer.rules.inline.blockSkip.exec(n));)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;null!=(s=this.tokenizer.rules.inline.anyPunctuation.exec(n));)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let r=!1,i="";for(;e;){let s;if(r||(i=""),r=!1,this.options.extensions?.inline?.some((n=>!!(s=n.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))continue;if(s=this.tokenizer.escape(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.tag(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.link(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(s.raw.length);const n=t.at(-1);"text"===s.type&&"text"===n?.type?(n.raw+=s.raw,n.text+=s.text):t.push(s);continue}if(s=this.tokenizer.emStrong(e,n,i)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.codespan(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.br(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.del(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.autolink(e)){e=e.substring(s.raw.length),t.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(e))){e=e.substring(s.raw.length),t.push(s);continue}let l=e;if(this.options.extensions?.startInline){let t=1/0;const n=e.slice(1);let s;this.options.extensions.startInline.forEach((e=>{s=e.call({lexer:this},n),"number"==typeof s&&s>=0&&(t=Math.min(t,s))})),t<1/0&&t>=0&&(l=e.substring(0,t+1))}if(s=this.tokenizer.inlineText(l)){e=e.substring(s.raw.length),"_"!==s.raw.slice(-1)&&(i=s.raw.slice(-1)),r=!0;const n=t.at(-1);"text"===n?.type?(n.raw+=s.raw,n.text+=s.text):t.push(s)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent)break;throw new Error(t)}}return t}}class fe{constructor(e){t(this,"options"),t(this,"parser"),this.options=e||u}space(e){return""}code({text:e,lang:t,escaped:n}){const s=(t||"").match(f.notSpaceStart)?.[0],r=e.replace(f.endingNewline,"")+"\n";return s?'<pre><code class="language-'+he(s)+'">'+(n?r:he(r,!0))+"</code></pre>\n":"<pre><code>"+(n?r:he(r,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){const t=e.ordered,n=e.start;let s="";for(let i=0;i<e.items.length;i++){const t=e.items[i];s+=this.listitem(t)}const r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+s+"</"+r+">\n"}listitem(e){let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?"paragraph"===e.tokens[0]?.type?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=n+" "+he(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",n="";for(let r=0;r<e.header.length;r++)n+=this.tablecell(e.header[r]);t+=this.tablerow({text:n});let s="";for(let r=0;r<e.rows.length;r++){const t=e.rows[r];n="";for(let e=0;e<t.length;e++)n+=this.tablecell(t[e]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+s+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${he(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),r=pe(e);if(null===r)return s;let i='<a href="'+(e=r)+'"';return t&&(i+=' title="'+he(t)+'"'),i+=">"+s+"</a>",i}image({href:e,title:t,text:n}){const s=pe(e);if(null===s)return he(n);let r=`<img src="${e=s}" alt="${n}"`;return t&&(r+=` title="${he(t)}"`),r+=">",r}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:he(e.text)}}class ke{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class be{constructor(e){t(this,"options"),t(this,"renderer"),t(this,"textRenderer"),this.options=e||u,this.options.renderer=this.options.renderer||new fe,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ke}static parse(e,t){return new be(t).parse(e)}static parseInline(e,t){return new be(t).parseInline(e)}parse(e,t=!0){let n="";for(let s=0;s<e.length;s++){const r=e[s];if(this.options.extensions?.renderers?.[r.type]){const e=r,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}const i=r;switch(i.type){case"space":n+=this.renderer.space(i);continue;case"hr":n+=this.renderer.hr(i);continue;case"heading":n+=this.renderer.heading(i);continue;case"code":n+=this.renderer.code(i);continue;case"table":n+=this.renderer.table(i);continue;case"blockquote":n+=this.renderer.blockquote(i);continue;case"list":n+=this.renderer.list(i);continue;case"html":n+=this.renderer.html(i);continue;case"paragraph":n+=this.renderer.paragraph(i);continue;case"text":{let r=i,l=this.renderer.text(r);for(;s+1<e.length&&"text"===e[s+1].type;)r=e[++s],l+="\n"+this.renderer.text(r);n+=t?this.renderer.paragraph({type:"paragraph",raw:l,text:l,tokens:[{type:"text",raw:l,text:l,escaped:!0}]}):l;continue}default:{const e='Token with "'+i.type+'" type was not found.';if(this.options.silent)return"";throw new Error(e)}}}return n}parseInline(e,t=this.renderer){let n="";for(let s=0;s<e.length;s++){const r=e[s];if(this.options.extensions?.renderers?.[r.type]){const e=this.options.extensions.renderers[r.type].call({parser:this},r);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){n+=e||"";continue}}const i=r;switch(i.type){case"escape":case"text":n+=t.text(i);break;case"html":n+=t.html(i);break;case"link":n+=t.link(i);break;case"image":n+=t.image(i);break;case"strong":n+=t.strong(i);break;case"em":n+=t.em(i);break;case"codespan":n+=t.codespan(i);break;case"br":n+=t.br(i);break;case"del":n+=t.del(i);break;default:{const e='Token with "'+i.type+'" type was not found.';if(this.options.silent)return"";throw new Error(e)}}}return n}}class we{constructor(e){t(this,"options"),t(this,"block"),this.options=e||u}preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?me.lex:me.lexInline}provideParser(){return this.block?be.parse:be.parseInline}}t(we,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));const je=new class{constructor(...e){t(this,"defaults",{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}),t(this,"options",this.setOptions),t(this,"parse",this.parseMarkdown(!0)),t(this,"parseInline",this.parseMarkdown(!1)),t(this,"Parser",be),t(this,"Renderer",fe),t(this,"TextRenderer",ke),t(this,"Lexer",me),t(this,"Tokenizer",xe),t(this,"Hooks",we),this.use(...e)}walkTokens(e,t){let n=[];for(const s of e)switch(n=n.concat(t.call(this,s)),s.type){case"table":{const e=s;for(const s of e.header)n=n.concat(this.walkTokens(s.tokens,t));for(const s of e.rows)for(const e of s)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=s;n=n.concat(this.walkTokens(e.items,t));break}default:{const e=s;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach((s=>{const r=e[s].flat(1/0);n=n.concat(this.walkTokens(r,t))})):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const n={...e};if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let s=e.renderer.apply(this,t);return!1===s&&(s=n.apply(this,t)),s}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),n.extensions=t),e.renderer){const t=this.defaults.renderer||new fe(this.defaults);for(const n in e.renderer){if(!(n in t))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;const s=n,r=e.renderer[s],i=t[s];t[s]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=i.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new xe(this.defaults);for(const n in e.tokenizer){if(!(n in t))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const s=n,r=e.tokenizer[s],i=t[s];t[s]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=i.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new we;for(const n in e.hooks){if(!(n in t))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;const s=n,r=e.hooks[s],i=t[s];we.passThroughHooks.has(n)?t[s]=e=>{if(this.defaults.async)return Promise.resolve(r.call(t,e)).then((e=>i.call(t,e)));const n=r.call(t,e);return i.call(t,n)}:t[s]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=i.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,s=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(s.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults={...this.defaults,...n}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return me.lex(e,t??this.defaults)}parser(e,t){return be.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{const s={...n},r={...this.defaults,...s},i=this.onError(!!r.silent,!!r.async);if(!0===this.defaults.async&&!1===s.async)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==t)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));r.hooks&&(r.hooks.options=r,r.hooks.block=e);const l=r.hooks?r.hooks.provideLexer():e?me.lex:me.lexInline,o=r.hooks?r.hooks.provideParser():e?be.parse:be.parseInline;if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(t):t).then((e=>l(e,r))).then((e=>r.hooks?r.hooks.processAllTokens(e):e)).then((e=>r.walkTokens?Promise.all(this.walkTokens(e,r.walkTokens)).then((()=>e)):e)).then((e=>o(e,r))).then((e=>r.hooks?r.hooks.postprocess(e):e)).catch(i);try{r.hooks&&(t=r.hooks.preprocess(t));let e=l(t,r);r.hooks&&(e=r.hooks.processAllTokens(e)),r.walkTokens&&this.walkTokens(e,r.walkTokens);let n=o(e,r);return r.hooks&&(n=r.hooks.postprocess(n)),n}catch(a){return i(a)}}}onError(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+he(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}};function ye(e,t){return je.parse(e,t)}ye.options=ye.setOptions=function(e){return je.setOptions(e),ye.defaults=je.defaults,g(ye.defaults),ye},ye.getDefaults=d,ye.defaults=u,ye.use=function(...e){return je.use(...e),ye.defaults=je.defaults,g(ye.defaults),ye},ye.walkTokens=function(e,t){return je.walkTokens(e,t)},ye.parseInline=je.parseInline,ye.Parser=be,ye.parser=be.parse,ye.Renderer=fe,ye.TextRenderer=ke,ye.Lexer=me,ye.lexer=me.lex,ye.Tokenizer=xe,ye.Hooks=we,ye.parse=ye,ye.options,ye.setOptions,ye.use,ye.walkTokens,ye.parseInline,be.parse,me.lex;const ve=Object.assign({});async function Se(){const e=[];try{const n=Object.assign({"/src/blogs/fnf-ios-port.mdx":l,"/src/blogs/hybrid-graphics-kvm-arch.mdx":a,"/src/blogs/ps3-pro.mdx":p});for(const[s,r]of Object.entries(n))try{const t=s.replace("/src/blogs/","").replace(".mdx",""),n=r;if(n.default&&"function"==typeof n.default){const s={slug:t,title:n.title||n.default.title||t.replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),date:n.date||n.default.date||(new Date).toISOString().split("T")[0],excerpt:n.excerpt||n.default.excerpt||"",thumbnail:n.thumbnail||n.default.thumbnail,content:n.default,type:"mdx"};e.push(s)}}catch(t){const e=new Error(`Error processing MDX file ${s}`);e.slug=s.replace("/src/blogs/","").replace(".mdx",""),e.path=s,e.type="compile",e.cause=t}}catch(t){const e=new Error("Error loading MDX files");e.type="load",e.cause=t}return e.sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}async function _e(){const e=[];try{for(const n in ve)try{const t=ve[n];if(!t)throw new Error(`No content found for ${n}`);const s=(n.split("/").pop()||"").replace(/\.md$/,""),r=t.replace(/\r\n/g,"\n"),i=r.match(/^---\s*\n([\s\S]*?)\n---\s*\n/),l=i?i[1]:"",o=r.replace(/^---\s*\n[\s\S]*?\n---\s*\n/,"").trim(),a=e=>{if(!l)return"";const t=l.match(new RegExp(`${e}:\\s*(.+?)\\s*(?:\\n|$)`));return t?.[1]?.trim()||""},c=a("date"),h=a("thumbnail"),p={slug:s,title:a("title")||s.replace(/-/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),date:c||(new Date).toISOString().split("T")[0],excerpt:a("excerpt")||"",...h&&{thumbnail:h},content:o,type:"md"};e.push(p)}catch(t){const e=new Error(`Error parsing MD post ${n}`),s=n.split("/").pop();s&&(e.slug=s.replace(/\.md$/,"")),e.path=n,e.type="parse",e.cause=t}}catch(t){const e=new Error("Error loading markdown files");e.type="load",e.cause=t}return e.sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}async function $e(){const[e,t]=await Promise.all([Se(),_e()]);return[...e,...t].filter(((e,t,n)=>n.findIndex((t=>t.slug===e.slug))===t)).sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}async function Re(e){try{const t=(await $e()).find((t=>t.slug===e))||null;if(t&&"md"===t.type){const e=t.content.replace(/!\[(.*?)\]\((?!http|\/)(.*?)\)/g,((e,n,s)=>`![${n}](/assets/img/blog-post-imgs/${t.slug}/${s})`)),n=await ye(e);t.content=n}return t}catch(t){const n=new Error(`Error getting post by slug: ${e}`);return n.slug=e,n.type="load",n.cause=t,null}}export{Re as g,$e as l};
//# sourceMappingURL=contentLoader-D_ZpG8NE.js.map
